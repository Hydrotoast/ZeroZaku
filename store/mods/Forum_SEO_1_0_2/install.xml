<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.2.xsd">
	<header>
		<license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
		<title lang="en">Forum SEO</title>
		<description lang="en">Forum SEO will let you use different forum description on index and viewforum.
Often we use short descriptions on index, else it will look messy.
The same description is displayed on viewforum. Thats not wise SEO.
We want at better description on viewforum, something the search engine can use to index our forums.
The description can also be used in the meta tag.
We will also make an improvement to the keywords meta tag.

Used wise this can be a powerfull SEO tool getting your forums indexed better.</description>

		<author-notes lang="en">
Credits: RMcGirr83 for helping me out and eviL3's Posting Template mod which I have used to get the ACP right.
		</author-notes>
		<author-group>
			<author>
				<realname>Stoker</realname>
				<username>Stokerpiller</username>
				<homepage>http://www.phpbb3bcodes.com</homepage>
			</author>
		</author-group>

		<mod-version>1.0.2</mod-version>

		<installation>
			<level>easy</level>
			<time>400</time>
			<target-version>3.0.5</target-version>
		</installation>
		
    		
		<link-group>
			<link type="parent" lang="en" href="contrib/Add_meta.xml">Add meta tags</link>
		</link-group>			

		<history>
			<entry>
				<date>2009-08-23</date>
				<rev-version>1.0.0</rev-version>
				<changelog lang="en">
					<change>Initial Release</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-09-20</date>
				<rev-version>1.0.1</rev-version>
				<changelog lang="en">
					<change>No longer needs to have a standard description to enable display of forum SEO.</change>
					<change>SEO description and keywords will no longer appear in ACP when forum is a link. Thanks RMcGirr83.</change>
					<change>Added text option at the bottom of the forum</change>
					<change>Up for phpBB 3.0.6</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-09-26</date>
				<rev-version>1.0.2</rev-version>
				<changelog lang="en">
					<change>Back to 3.0.5.</change>
				</changelog>
			</entry>
		</history>
		
	</header>
	<action-group>
    <sql>ALTER TABLE phpbb_forums ADD forum_seo_key varchar(255) NOT NULL;
ALTER TABLE phpbb_forums ADD forum_seo_desc TEXT NOT NULL;
ALTER TABLE phpbb_forums ADD forum_seo_bottom TEXT NOT NULL;</sql>
		<open src="adm/style/acp_forums.html">
			<edit>
				<find><![CDATA[	<div id="forum_cat_options">]]></find>
				<action type="before-add"><![CDATA[	<!-- IF not S_FORUM_LINK -->
	<div id="forum_seo_options">
		<fieldset>
			<legend>{L_FORUM_SEO_SETTINGS}</legend>
		<dl>
			<dt><label for="forum_seo_key">{L_FORUM_SEO_KEY}:</label><br /><span>{L_FORUM_SEO_KEY_EXPLAIN}</span></dt>
			<dd><input class="text medium" type="text" id="forum_seo_key" name="forum_seo_key" value="{FORUM_SEO_KEY}" maxlength="255" /></dd>
		</dl>
		<dl>
			<dt><label for="forum_seo_desc">{L_FORUM_SEO_DESC}:</label><br /><span>{L_FORUM_SEO_DESC_EXPLAIN}</span></dt>
			<dd><textarea id="forum_seo_desc" name="forum_seo_desc" rows="5" cols="45" maxlength="255">{FORUM_SEO_DESC}</textarea></dd>
		</dl>
		<dl>
			<dt><label for="forum_seo_bottom">{L_FORUM_SEO_BOTTOM}:</label><br /><span>{L_FORUM_SEO_BOTTOM_EXPLAIN}</span></dt>
			<dd><textarea id="forum_seo_bottom" name="forum_seo_bottom" rows="5" cols="45" maxlength="255">{FORUM_SEO_BOTTOM}</textarea></dd>
		</dl>
		</fieldset>
	</div>
	<!-- ENDIF -->]]></action>
			</edit>
		</open>
		<open src="includes/acp/acp_forums.php">
			<edit>
				<find><![CDATA[						'forum_desc_bitfield'	=> '',]]></find>
				<action type="after-add"><![CDATA[						'forum_seo_key'         => utf8_normalize_nfc(request_var('forum_seo_key', '', true)),
						'forum_seo_desc'      	=> utf8_normalize_nfc(request_var('forum_seo_desc', '', true)),
						'forum_seo_bottom'      => utf8_normalize_nfc(request_var('forum_seo_bottom', '', true)),]]></action>
			</edit>
			<edit>
				<find><![CDATA[							'forum_desc'			=> '',]]></find>
				<action type="after-add"><![CDATA[							'forum_seo_key'         => '',
							'forum_seo_desc'      	=> '',
							'forum_seo_bottom'      => '',]]></action>
			</edit>
			<edit>
				<find><![CDATA[					'S_DESC_URLS_CHECKED'		=> ($forum_desc_data['allow_urls']) ? true : false,]]></find>
				<action type="after-add"><![CDATA[					'FORUM_SEO_KEY'            	=> $forum_data['forum_seo_key'],
					'FORUM_SEO_DESC'            => $forum_data['forum_seo_desc'],
					'FORUM_SEO_BOTTOM'          => $forum_data['forum_seo_bottom'],]]></action>
			</edit>			
		</open>			
		<open src="includes/functions_display.php">
			<edit>
				<find><![CDATA[		'FORUM_DESC'	=> generate_text_for_display($forum_data['forum_desc'], $forum_data['forum_desc_uid'], $forum_data['forum_desc_bitfield'], $forum_data['forum_desc_options']))]]></find>
				<action type="before-add"><![CDATA[		'FORUM_SEO_KEY'         => $forum_data['forum_seo_key'],
		'FORUM_SEO_DESC'        => $forum_data['forum_seo_desc'],
		'FORUM_SEO_BOTTOM'      => $forum_data['forum_seo_bottom'],]]></action>
			</edit>
		</open>
		<open src="language/en/acp/forums.php">
			<edit>
				<find><![CDATA[?>]]></find>
				<action type="before-add"><![CDATA[//Forum SEO
$lang = array_merge($lang, array(
	'FORUM_SEO_SETTINGS'			=> 'Forum SEO',
	'FORUM_SEO_KEY'					=> 'SEO keywords',
	'FORUM_SEO_KEY_EXPLAIN'			=> 'Enter your preferred SEO keywords here. Seperate with comma: ",".',
	'FORUM_SEO_DESC'				=> 'SEO description',
	'FORUM_SEO_DESC_EXPLAIN'		=> 'Enter your preferred SEO description here.',
	'FORUM_SEO_BOTTOM'				=> 'SEO bottom',
    'FORUM_SEO_BOTTOM_EXPLAIN'		=> 'Enter your preferred SEO bottom description here.<br />This is displayed at the bottom of the forum.',
));]]></action>
			</edit>
		</open>				
		<open src="styles/prosilver/template/viewforum_body.html">
			<edit>
				<find><![CDATA[<!-- IF FORUM_DESC or MODERATORS or U_MCP -->]]></find>
				<action type="replace-with"><![CDATA[<!-- IF FORUM_DESC or FORUM_SEO_DESC or MODERATORS or U_MCP -->]]></action>
			</edit>
			<edit>
				<find><![CDATA[	<!-- IF FORUM_DESC --><span style="display: none">{FORUM_DESC}<br /></span><!-- ENDIF -->]]></find>
				<action type="replace-with"><![CDATA[	<!-- IF FORUM_SEO_DESC --><span style="font-weight:bold;">{FORUM_SEO_KEY}</span><br /><span>{FORUM_SEO_DESC}<br /></span><!-- ELSEIF FORUM_DESC --><span>{FORUM_DESC}<br /></span><!-- ENDIF -->]]></action>
			</edit>
			<edit>
				<find><![CDATA[<!-- INCLUDE jumpbox.html -->]]></find>
				<action type="before-add"><![CDATA[<!-- IF FORUM_SEO_BOTTOM --><br /><div><span>{FORUM_SEO_BOTTOM}</span></div><!-- ENDIF -->]]></action>
			</edit>
		</open>	
				<diy-instructions lang="en">Purge board cache and refresh the prosilver template.
Go to ACP -> Forums and type in your descriptions and keywords. Its important that you chose them wisely.</diy-instructions>
	</action-group>
</mod>
