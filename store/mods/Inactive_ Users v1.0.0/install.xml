<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="./modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http
://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.2.xsd">
	<header>		   
		<license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
		
		<title lang="en">Inactive and Banned Users` Custom Titles &amp; Avatars</title>  
		<title lang="tr">Aktif Olmayan ve Yasaklı Kullanıcılara Özel Seviye ve Avatar </title> 
		
		<description lang="en">This MOD assigns one of "the Inactive for X months" (3 months default), "Deactivated", "Banned" and "Suspended until X time" custom titles and/or avatars, also provides two default avatars and remove rank images of inactive users.</description>
		<description lang="tr">Bu eklenti panoya 3 aydan daha uzun süre giriş yapmayanlara ve yasaklı kullanıcılara otomatik özel seviye ve avatar atar. Ayrıca avatar seçmeyenlere mesaj sayılarına göre 2 farklı varsayılan avatar atar ve aktif olmayan kullanıcı seviye resimlerini kaldırır.</description>		


		<author-notes lang="en">
		[*] Some users can be excluded by entering their user IDs at ACP. 
		[*] Enabling banned, inactive users custom titles and avatars can be set at ACP for viewtopic and member profile pages separately. 		
		[*] Default avatars can be enabled and disabled independently. Users who has fewer than 25 posts take a new user default avatar, others take another one.  		
		[*] If enabled at ACP, this is the intended order to show inactive custom titles and avatars.
			Banned/suspended, Inactive/deactivated (deactivated is seen only at viewtopic), normal users, 2 default avatar (25 post number selector)
		
		I first made this modification for inactive users more then 3 months for myself. After deciding to package and release it, I thought adding a few more features like custom avatars for banned users would be nice. 
		
		This is my first mod, I just examined the phpbb files and install.xml files and codes of other mods, thus learnt a little. I want to thank to a few people for some indirect help making this modification released.
		- I would like to thank Stitch625, since I learnt to provide ACP control of inactive months duration and got used to template edits while installing his Custom Rank Titles mod.
		- I would like to thank lefty74 as well, since I used his codes from Top poster mod to provide ACP controlled list of excluded user ids, enable-disable features.
		- I thank Handyman as he posted with a few sql= lines I used below. 
		- I thank ^[GS]^ for starting memberlist_view page edits and others for encouragement. 	
		- I thank stokerpiller as I firstly inspired inactive custom avatars from his default avatar guide at startrekguide.com site.
		- The last but not the least, I also thank angelside/ALEXIS, since I learnt many useful tips and a few functions like in_array, I used in this modification, on phpbbturkiye.net Turkish phpbb community support board. 
		</author-notes>
		<author-notes lang="tr">
		[*] Varsayılan 3 aylık aktif olmayan süreyi değiştirmek için. 
			 YP / Pano Ayarları / Aktif olmayan ve Yasaklı kullanıcılar özel seviye ve avatarları
		[*] Kullanıcı id değerleri girilerek bazı üyeler muaf tutulabilir
		[*] Yasaklı ve aktif olmayan üye seviye ve avatarı özelliği Yönetim Panelinde kapatılabilir.
		[*] Yetkililer geçici yasaklı üyeye gösterilen yasaklama sebebini profilde ve viewtopic de görebilir.
		</author-notes>
		
		<author-group>
			<author>
				<username>mtrs</username>
				<email>trst2007@gmail.com</email>				
			</author> 
		</author-group>
		
		<mod-version>1.0.0</mod-version>
		
		<installation>
			<level>easy</level>
			<time>300</time>
			<target-version>3.0.5</target-version>
		</installation>
		
		<history>
			<entry>
				<date>2009-06-20</date>
				<rev-version>1.0.0</rev-version>
				<changelog lang="en">
					<change>version change</change>				
					<change>UMIL RC3 update</change>
				</changelog>					
			</entry>		
			<entry>
				<date>2009-04-12</date>
				<rev-version>0.4.0</rev-version>
				<changelog lang="en">
					<change>Code rewritten - function file used</change>				
					<change>Template edits removed, mod simplified</change>
					<change>A user permission to view custom avatar and titles added</change>
					<change>UMIL suppport added</change>
				</changelog>					
			</entry>		
			<entry>
				<date>2008-10-19</date>
				<rev-version>0.3.1</rev-version>
				<changelog lang="en">
					<change>Bug fix in memberlist_view</change>
					<change>Language file entry</change>
					<change>Template paths variable and avatar names changed</change>
				</changelog>					
			</entry>		
			<entry>
				<date>2008-10-02</date>
				<rev-version>0.3.0</rev-version>
				<changelog lang="en">
					<change>Disable custom avatars option for viewtopic added</change>									
				</changelog>					
			</entry>		
			<entry>
				<date>2008-08-30</date>
				<rev-version>0.2.5</rev-version>
				<changelog lang="en">
					<change>Language files seperated to a different file</change>									
				</changelog>					
			</entry>		
			<entry>
				<date>2008-08-25</date>
				<rev-version>0.2.4</rev-version>
				<changelog lang="en">
					<change>Fix to cancel viewing ranks twice in member profile</change>					
					<change>A few syntax changes for coding guidelines</change>
					<change>Fix to ignore inactive title for those who never logged in</change>					
					<change>Fix bug if quest poster open a new topic to be approved</change>					
					<change>Mod package separated for subsilver2 and language files to comply modx-1.2.0</change>
				</changelog>
			</entry>		
			<entry>
				<date>2008-08-17</date>
				<rev-version>0.2.3</rev-version>
				<changelog lang="en">
					<change>Fix bug for suspended user wrong time end</change>
					<change>Turkish language support added</change>
				</changelog>		
			</entry>		
			<entry>
				<date>2008-08-17</date>
				<rev-version>0.2.2</rev-version>
				<changelog lang="en">
					<change>Fix wrong inactive title for new users </change>
				</changelog>		
			</entry>		
			<entry>
				<date>2008-08-14</date>
				<rev-version>0.2.1</rev-version>
				<changelog lang="en">
					<change>Fix a long inactive title issue </change>
					<change>Added poster_id check for banned and suspended users</change>
					<change>Fix known issue of distinguishing two ban</change>
					<change>Fix bug for suspended title in memberlist</change>
				</changelog>		
			</entry>		
			<entry>
				<date>2008-08-10</date>
				<rev-version>0.2.0</rev-version>
				<changelog lang="en">
					<change>ACP controlled disable options</change> 
					<change>memberprofile_view support for banned, suspended and inactive users</change>
					<change>"Ban reason shown to users" added to be seen by mods at viewtopic and profiles for only temporary bans</change>
					<change>User_id inclusion feature added to make custom titles and avatars only seeb by certain users</change>
					<change>Custom and default avatars features added</change>
				</changelog>		
			</entry>		
			<entry>
				<date>2008-08-05</date>
				<rev-version>0.1.0</rev-version>
				<changelog lang="en">
					<change>Subsilver2 support added</change>
					<change>Some of the deactive, inactive, banned and suspended users bugs fixed</change>
					<change>Founders wont take banned/suspended title</change> 
				</changelog>		
			</entry>		
			<entry>
				<date>2008-08-01</date>
				<rev-version>0.0.3</rev-version>
				<changelog lang="en">
					<change>Added banned and suspended users custom title support </change>
				</changelog>		
			</entry>		
			<entry>
				<date>2008-07-29</date>
				<rev-version>0.0.2</rev-version>
				<changelog lang="en">
					<change>Added ACP controlled excluded users list feature</change>
					<change>Deactivated users included for viewtopic page</change>
				</changelog>		
			</entry>			
			<entry>
				<date>2008-07-27</date>
				<rev-version>0.0.1</rev-version>
				<changelog lang="en">
					<change>Initial Release</change>
				</changelog>
			</entry>
		</history> 
		<link-group>
			<link type="language" href="tr.xml" lang="en">Turkish</link>
			<link type="language" href="tr.xml" lang="tr">Türkçe</link>
		</link-group>
	</header>	
	<action-group> 
	
	<copy>
			<file from="root/includes/functions_inactive_users.php" to="includes/functions_inactive_users.php" />
			<file from="root/language/en/mods/inactive_users.php" to="language/en/mods/inactive_users.php" />
			<file from="root/language/en/mods/info_acp_inactive_users.php" to="language/en/mods/info_acp_inactive_users.php" />
			<file from="root/language/en/mods/permissions_inactive_users.php" to="language/en/mods/permissions_inactive_users.php" />
			<file from="root/install_inactive_users.php" to="install_inactive_users.php" />			
			<file from="root/images/avatars/*.*" to="images/avatars/*.*" />
			<file from="root/umil/*.*" to="umil/*.*" />
	</copy>

				<open src="viewtopic.php">										
						<edit>
						<find><![CDATA[				'joined'		=> '',]]></find>
							<action type="after-add"><![CDATA[		// Begin : Inactive and Banned Users` Custom Titles & Avatars
				'lastvisit'		=> '',
				'type'			=> '',
		// End : Inactive and Banned Users` Custom Titles & Avatars]]></action>
						</edit>										
						
						<edit>
						<find><![CDATA[				'joined'		=> $user->format_date($row['user_regdate'], "M jS Y", true),]]></find>
							<action type="after-add"><![CDATA[		// Begin : Inactive and Banned Users` Custom Titles & Avatars
				'lastvisit'		=> $row['user_lastvisit'],
				'type'			=> $row['user_type'],
		// End : Inactive and Banned Users` Custom Titles & Avatars]]></action>
						</edit>
						
						<edit>
						<find><![CDATA[unset($id_cache);]]></find>
							<action type="before-add"><![CDATA[// Begin : Inactive and Banned Users` Custom Titles & Avatars
if ($config['inactive_users_enable'] && $auth->acl_get('u_view_customavatars'))
{
	include($phpbb_root_path . 'includes/functions_inactive_users.' . $phpEx);
	$banned_user_list = get_banned_user_list();
	$excluded_user_ids = array(); 
	$excluded_user_ids = ($config['inactive_users_exc_ids']) ? explode(",", $config['inactive_users_exc_ids']) : array();
}
// End : Inactive and Banned Users` Custom Titles & Avatars]]></action>
						</edit>																	
						
						<edit>
							<find><![CDATA[	// Dump vars into template]]></find>
							<action type="before-add"><![CDATA[// Begin : Inactive and Banned Users` Custom Titles & Avatars
if ($config['inactive_users_enable'] && $auth->acl_get('u_view_customavatars') && !in_array($poster_id, $excluded_user_ids))
{
	$inactive_data = banned_user_templates($poster_id, $banned_user_list, $user_cache[$poster_id]['lastvisit'], $user_cache[$poster_id]['avatar'],$user_cache[$poster_id]['posts'], $user_cache[$poster_id]['type']);
	if (sizeof($inactive_data))
	{
		$postrow = array_merge($postrow, $inactive_data);
	}
}
// End : Inactive and Banned Users` Custom Titles & Avatars]]></action>
						</edit>														
				</open>
				<open src="memberlist.php">
						<edit>
							<find><![CDATA[if (!empty($profile_fields['row']))]]></find>
							<action type="before-add"><![CDATA[// Begin : Inactive and Banned Users` Custom Titles & Avatars            
if ($config['inactive_users_enable'] && $auth->acl_get('u_view_customavatars'))
{
	include($phpbb_root_path . 'includes/functions_inactive_users.' . $phpEx);
	$inactive_data = obtain_user_ban_info($user_id, $member['user_lastvisit'], $member['user_posts'], $member['user_type'], $poster_avatar);
	if ($inactive_data)
	{
		$template->assign_vars($inactive_data);
	}
}
// End : Inactive and Banned Users` Custom Titles & Avatars]]></action>
						</edit>
				</open>
				<open src="includes/acp/acp_board.php">
						<edit>
							<find><![CDATA[						'warnings_expire_days'	=> array('lang' => 'WARNINGS_EXPIRE',		'validate' => 'int',	'type' => 'text:3:4', 'explain' => true, 'append' => ' ' . $user->lang['DAYS']),]]></find>
						<action type="after-add"><![CDATA[				// Begin : Inactive and Banned Users` Custom Titles & Avatars
				//If other mods are installed you may have to change legend3 to the next available legend number
					'legend3'						=> 'INACTIVE_USERS_TITLES',
					'inactive_users_enable'					=> array('lang' => 'INACTIVE_USERS_ENABLE',		'validate' => 'bool',	'type' => 'radio:yes_no', 'explain' => false),
					'inactive_users_excl_view_ban'			=> array('lang' => 'INACTIVE_USERS_EXCL_VIEW_BAN',		'validate' => 'bool',	'type' => 'radio:yes_no', 'explain' => false),
					'inactive_users_excl_view_time'			=> array('lang' => 'INACTIVE_USERS_EXCL_VIEW_TIME',		'validate' => 'bool',	'type' => 'radio:yes_no', 'explain' => false),
					'inactive_users_excl_prof_ban'			=> array('lang' => 'INACTIVE_USERS_EXCL_PROF_BAN',		'validate' => 'bool',	'type' => 'radio:yes_no', 'explain' => false),
					'inactive_users_excl_prof_time'			=> array('lang' => 'INACTIVE_USERS_EXCL_PROF_TIME',		'validate' => 'bool',	'type' => 'radio:yes_no', 'explain' => false),					
					'inactive_users_avatar_view_enable'		=> array('lang' => 'INACTIVE_USERS_AVATAR_VIEW_ENABLE',		'validate' => 'bool',	'type' => 'radio:yes_no', 'explain' => false),
					'inactive_users_avatar_prof_enable'		=> array('lang' => 'INACTIVE_USERS_AVATAR_PROF_ENABLE',		'validate' => 'bool',	'type' => 'radio:yes_no', 'explain' => false),
					'inactive_users_no_avatar'				=> array('lang' => 'INACTIVE_USERS_NO_AVATAR',		'validate' => 'bool',	'type' => 'radio:yes_no', 'explain' => false),											
					'inactive_users_period'					=> array('lang' => 'INACTIVE_USERS_PERIOD',		'validate' => 'string',	'type' => 'text:5:6', 'explain' => true),
					'inactive_users_exc_ids'				=> array('lang' => 'INACTIVE_USERS_EXC_IDS',	'validate' => 'string',	'type' => 'text:25:255', 'explain' => true),
				// End : Inactive and Banned Users` Custom Titles & Avatars]]></action>
					</edit>
				</open>
		<diy-instructions lang="en">Point and run your browser at /install_inactive_users.php
After installing this mod, set the options at ACP-> General -> Board Settings
Set user/group permission to view custom avatars and titles YES</diy-instructions>	
<diy-instructions lang="tr">Tarayıcıyı /install_inactive_users.php adresine getirip çalıştırın
Eklenti kurulumundan sonra, Yönetim paneli -> Genel -> Pano özellikleri yolunda ayarları yapın
Özel avatar ve seviye başlığı görmek içni kullanıcı veya grup izini ayarını EVET yapın</diy-instructions>	
</action-group> 
</mod>
