<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<?xml-stylesheet type="text/xsl" href="./modx.prosilver.en.xsl"?>
<!--For security purposes, please check: http
://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.3.xsd">
	<header>
		<license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
		
		<title lang="en">Groups on Registration and Custom Profile Fields</title>
		<title lang="tr">Kayıtta Grup Üyeliği ve Özel Profil Alanları</title>

		<description lang="en">This mod can display groups on registration screen to join. Displayed groups cannot be special groups; request, closed and hidden type group membership requests need to be approved. It can also brings the ability of adding users to groups based on custom profile fields data. Whenever a user's custom profile fields data is changed, custom profile fields groups are updated. Admininistrators can batch add/remove users to/from custom profile fields based groups at ACP.</description>
		<description lang="tr">Grupları kayıt ekranında gösterebilir. Özel gruplar kayıtta gösterilemez; gösterilen grupların türü istek, kapalı veya gizli ise üyelik için onay gereklidir. Ayrıca özel profil alanlarına bağlı grup üyeliği özelliği getirir. Kullanıcı özel profil alanları değiştirilirse, özel profil alanlarına bağlı grup üyelikleri güncellenir. Yönetim panelinde özel profil alanlarına bağlı gruplar senkronize edilerek toplu halde üye ekleme çıkarma işlemi yapılabilir.</description>

		<author-notes lang="en"></author-notes>
		<author-notes lang="tr"></author-notes>
		
		<author-group>
			<author>
				<realname></realname>
				<username>mtrs</username>
				<email>trst2007@gmail.com</email>
			</author>
		</author-group>
		
		<mod-version>1.0.1</mod-version>	
		<installation>
			<level>easy</level>
			<time>300</time>
			<target-version>3.0.6</target-version>
		</installation> 

		<history>
			<entry>
				<date>2009-06-09</date>
				<rev-version>0.0.1</rev-version>
				<changelog lang="en">
					<change>Initial release</change>
				</changelog>
				<changelog lang="tr">
					<change>İlk sürüm</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-06-10</date>
				<rev-version>0.0.2</rev-version>
				<changelog lang="en">
					<change>Ignore Auto groups</change>
					<change>Custom profile fields to auto group add on registration</change>
				</changelog>
				<changelog lang="tr">
					<change>Auto grupları yok sayma</change>
					<change>Özel profil alanları ile kayıtta otomatik grup kaydı</change>					
				</changelog>
			</entry>
			<entry>
				<date>2009-06-11</date>
				<rev-version>0.0.3</rev-version>
				<changelog lang="en">
					<change>Ability to batch auto add users based on already filled dropdownbox type custom profile fields</change>
					<change>Mod name changed to reflect custom profile fields based new features</change>
				</changelog>
				<changelog lang="tr">
					<change>Özel profil alanı bilgileri ile eski üyeleri toplu olarak otomatik grup üyesi yapma</change>
					<change>Eklenti adı eklenen özel profil alanları özelliklerini de yansıtmak için değiştirilmiştir</change>					
				</changelog>
			</entry>
			<entry>
				<date>2009-07-27</date>
				<rev-version>1.0.0-RC1</rev-version>
				<changelog lang="en">
					<change>ACP module added</change>
					<change>UMIL supported install script added</change>
					<change>Auto group add remove based custom profile fields on UCP added</change>
				</changelog>
				<changelog lang="tr">
					<change>ACP modülü eklendi</change>
					<change>UMIL destekli kurulum dosyası eklendi</change>
					<change>Özel profil alanlarının kullanıcı panelinde değişimine göre otomatik gruba ekleme</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-07-30</date>
				<rev-version>1.0.0-RC2</rev-version>
				<changelog lang="en">
					<change>Admin and moderator groups are not listed</change>
					<change>If group membership need pending, add users to group with pending</change>
				</changelog>
				<changelog lang="tr">
					<change>Yönetici ve yetkili grupları listelenmez</change>
					<change>Grup üyeliği onay gerektiriyorsa, üyelik onayla olur</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-08-08</date>
				<rev-version>1.0.0-RC3</rev-version>
				<changelog lang="en">
					<change>Bug fix on group default and pending</change>
					<change>Run button added to groups on registratio module control</change>
					<change>Fix php notice in functions_group_on_regs.php line 191</change>
					<change>Update DIY field</change>
				</changelog>
				<changelog lang="tr">
					<change>Varsayılan grup ve grup katılım isteği hata düzeltmesi</change>
					<change>Yönetim paneli modülü özel profil alanı güncelleme tuşu eklendi</change>
					<change>functions_group_on_regs.php dosyası satır 191 php notice düzeltmesi</change>
					<change>DIY alanı güncellendi</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-08-10</date>
				<rev-version>1.0.0-RC4</rev-version>
				<changelog lang="en">
					<change>Select multiple group on registration checkbox added</change>
				</changelog>
				<changelog lang="tr">
					<change>Kayıtta birden fazla grup seçme kutusu seçeneği eklendi</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-08-15</date>
				<rev-version>1.0.0-RC5</rev-version>
				<changelog lang="en">
					<change>Bug fix in cpf based group add function</change>
					<change>Custom profile fields based groups auto add without pending option added</change>
				</changelog>
				<changelog lang="tr">
					<change>Özel profil alanı temelli gruplar hata düzeltmesi</change>
					<change>Özel profil alanı temelli gruplara onay olmadan otomatik ekleme seçeneği eklendi</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-08-30</date>
				<rev-version>1.0.0</rev-version>
				<changelog lang="en">
					<change>Install script replaced with UMIL Auto type</change>
					<change>Language file changes</change>
				</changelog>
				<changelog lang="tr">
					<change>Kurulum kodu UMIL Auto türü ile değiştirildi</change>
					<change>Dil dosyası düzenlemeleri</change>					
				</changelog>
			</entry>
			<entry>
				<date>2009-11-21</date>
				<rev-version>1.0.1</rev-version>
				<changelog lang="en">
					<change>MODDB denial after changes</change>
					<change>Magic number replaced with a constant</change>
				</changelog>
				<changelog lang="tr">
					<change>MODDB reddi sonrası değişiklikler</change>
					<change>Sihirli sayı sabit ile değiştirildi</change>			
				</changelog>
			</entry>			
		</history> 
	<link-group>
		<link type="template" href="./subsilver2.xml" lang="en">subsilver2</link>
		<link type="template" href="./subsilver2.xml" lang="tr">subsilver2</link>
		<link type="language" href="./tr.xml" lang="en">Turkish</link>
		<link type="language" href="./tr.xml" lang="tr">Türkçe</link>
	</link-group>
	</header>
	
	<action-group>
		<copy>
			<file from="root/includes/functions_group_on_regs.php" to="includes/functions_group_on_regs.php"></file>
			<file from="root/includes/acp/info/acp_groups_reg.php" to="includes/acp/info/acp_groups_reg.php" />	
			<file from="root/includes/acp/acp_groups_reg.php" to="includes/acp/acp_groups_reg.php" />
			<file from="root/adm/style/acp_groups_regs.html" to="adm/style/acp_groups_regs.html" />		
			<file from="root/language/en/mods/info_acp_group_on_regs.php" to="language/en/mods/info_acp_group_on_regs.php"></file>						
			<file from="root/language/en/mods/group_on_regs.php" to="language/en/mods/group_on_regs.php"></file>
			<file from="root/language/en/mods/umil_groups_on_reg.php" to="language/en/mods/umil_groups_on_reg.php"></file>
			<file from="root/install_groups_cpf_reg.php" to="install_groups_cpf_reg.php"></file>
			<file from="root/umil/*.*" to="umil/*.*" />
		</copy>
		
		<open src="ucp.php">	
			<edit>
				<find><![CDATA[require($phpbb_root_path . 'includes/functions_module.' . $phpEx);]]></find>
				<action type="after-add"><![CDATA[//Begin: Group on Registration and Custom Profile Fields 
include($phpbb_root_path . 'includes/functions_group_on_regs.' . $phpEx);
//End: Group on Registration and Custom Profile Fields ]]></action>
			</edit>									
		</open>
		
		<open src="includes/ucp/ucp_register.php">
			<edit>
				<find><![CDATA[			'tz'				=> request_var('tz', (float) $timezone),]]></find>
				<action type="after-add"><![CDATA[			//Begin: Group on Registration and Custom Profile Fields
			'reg_group_id'		=> ($config['groups_on_reg_multiple']) ?  request_var('reg_group_id', array(0)) : request_var('reg_group_id', 0),
			//End: Group on Registration and Custom Profile Fields]]></action>
			</edit>			
			<edit>
				<find><![CDATA[				'lang'				=> array('match', false, '#^[a-z_\-]{2,}$#i'),]]></find>
				<action type="after-add"><![CDATA[				//Begin: Group on Registration and Custom Profile Fields 
				'reg_group_id'		=> array('reg_group_id', (($config['groups_require'] && $config['groups_on_reg_enable']) ? false : true), 1, 150),
				//End: Group on Registration and Custom Profile Fields]]></action>
			</edit>
			<edit>
				<find><![CDATA[				if ($user_id === false)
				{
					trigger_error('NO_USER', E_USER_ERROR);
				}]]></find>
				<action type="after-add"><![CDATA[				//Begin: Group on Registration and Custom Profile Fields
				if ($config['groups_on_reg_enable'])
				{
					if ($config['groups_on_reg_multiple'])
					{
						foreach ($data['reg_group_id'] as $add_group_id)
						{ 
							//Add user to the selected groups
							group_add_registration($user_id, $add_group_id);
						}
					}
					else
					{
						group_add_registration($user_id, $data['reg_group_id']);
					}
				}
				if ($config['groups_to_cpf_enable'])
				{
					group_add_delete_user_cpf($user_id);
				}			
				//End: Group on Registration and Custom Profile Fields]]></action>
			</edit>				
			<edit>
				<find><![CDATA[		$template->assign_vars(array(
			'ERROR'				=> (sizeof($error)) ? implode('<br />', $error) : '',]]></find>
				<action type="before-add"><![CDATA[		//Begin: Group on Registration and Custom Profile Fields
		if ($config['groups_on_reg_enable'])
		{
			group_on_registration();
		}
		//End: Group on Registration and Custom Profile Fields]]></action>
			</edit>				
			<edit>
				<find><![CDATA[			'S_UCP_ACTION'		=> append_sid("{$phpbb_root_path}ucp.$phpEx", 'mode=register'),]]></find>
				<action type="after-add"><![CDATA[			//Begin: Group on Registration and Custom Profile Fields
			'S_GROUP_OPTIONS'	=> ($config['groups_on_reg_enable']) ? reg_group_select($data['reg_group_id']) : false,
			//End: Group on Registration and Custom Profile Fields]]></action>
			</edit>		
		</open>		
		<open src="includes/functions_profile_fields.php">	
			<edit>
				<find><![CDATA[			$db->sql_return_on_error(false);
		}]]></find>
				<action type="after-add"><![CDATA[		//Begin: Group on Registration and Custom Profile Fields
		global $config, $phpbb_root_path, $phpEx;
		if ($config['groups_to_cpf_enable'])
		{	
			if (!function_exists('group_add_delete_user_cpf'))
			{
				include($phpbb_root_path . 'includes/functions_group_on_regs.' . $phpEx);
			}
			group_add_delete_user_cpf($user_id);
		}								
		//End: Group on Registration and Custom Profile Fields]]></action>
			</edit>									
		</open>		
		
		<open src="styles/prosilver/template/ucp_register.html">
			<edit>
				<find><![CDATA[	</fieldset>]]></find>
				<action type="before-add"><![CDATA[	<!-- IF S_GROUPS_ON_REGISTRATION -->
		<dl>
			<dt><label>{L_GROUPS_ON_REGISTRATION}: <!-- IF S_GROUPS_REQUIRED -->*<!-- ENDIF --></label><br /><span>{GROUPS_REGISTRATION_EXP}</span></dt>
			<dd><!-- IF S_GROUPS_ON_REG_MULTIPLE --><div style="height: 6em; width: 12em; overflow: auto;">{S_GROUP_MULTIPLE_OPTIONS}</div><!-- ELSE --><select name="reg_group_id" id="reg_group_id" class="autowidth">{S_GROUP_OPTIONS}</select><!-- ENDIF --></dd>
		</dl>
	<!-- ENDIF -->]]></action>
			</edit>
		</open>
	
		<diy-instructions lang="en">Open your web browser, execute and delete /install_groups_cpf_reg.php
Enable and configure the mod at ACP -> USERS AND GROUPS -> GROUPS -> Groups on registration</diy-instructions>
		<diy-instructions lang="tr">Taraycıcınızda /install_groups_cpf_reg.php dosyasını çalıştırıp silin.
Kayıtta gruplar eklentisini etkinleştirip ayarlayın
Yönetim Paneli -> KULLANICI ve GRUPLAR -> Gruplar -> Kayıtta gruplar</diy-instructions>
	</action-group>
</mod>
