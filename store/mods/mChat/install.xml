<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
	<?xml-stylesheet type="text/xsl" href="./contrib/modx.prosilver.en.xsl"?>
		<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD. Although MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD. No support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
		<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.3.xsd">
	<header>
		<license>http://opensource.org/licenses/gpl-license.php GNU General Public License v2</license>
			<title lang="en">mChat</title>
				<description lang="en">Ðœini-chat for the forum index and seperate page.</description>
		<author-group>
			<author>
				<realname>Rich McGirr</realname>
				<username>RMcGirr83</username>
				<homepage>http://rmcgirr83.org</homepage>
			</author>
			<author>
				<realname>Shaun</realname>
				<username>djs596</username>
				<homepage>http://djs596.com</homepage>
			</author>
			<author>
				<realname>Stoker</realname>
				<username>Stokerpiller</username>
				<homepage>http://www.phpbb3bcodes.com</homepage>
			</author>
			<author>
				<realname>Shapoval Andrey Vladimirovich</realname>
				<username>AllCity</username>
      		<contributions-group>
      		  <contributions status="past" from="2009-04-24" to="2009-08-13" position="Developer"/>
      		</contributions-group>				
			</author>			
		</author-group>
		<mod-version>1.2.17</mod-version>
		<installation>
			<level>easy</level>
			<time>300</time>
			<target-version>3.0.6</target-version>
		</installation>
		<history>
			<entry>
				<date>2009-04-24</date>
				<rev-version>1.0.0</rev-version>
				<changelog lang="en">
					<change>Initial Release.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-04-25</date>
				<rev-version>1.0.1</rev-version>
				<changelog lang="en">
					<change>Fixed bug with auto focus message field for IE.</change>
					<change>Fixed bug for style ProSilver in IE6.</change>
					<change>Fixed indicator (load, error, ok) for IE.</change>
					<change>Fixed sound (now the place where the sound is hiden).</change>
					<change>Fixed bug for Apache2 (did not send status query).</change>
					<change>Minor bugfixes.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-04-26</date>
				<rev-version>1.0.2</rev-version>
				<changelog lang="en">
					<change>Added the ability to not allow use special bbcodes.</change>
					<change>Fixed errors in server log (Undefined variable: mchat_include_index in .../mchat.php).</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-05-01</date>
				<rev-version>1.2.0</rev-version>
				<changelog lang="en">
					<change>New installer for database.</change>
					<change>jQuery fixed a conflict with other JavaScript Library.</change>
					<change>Added archive of messages.</change>
					<change>Added a limit on the maximum number of characters in one message.</change>
					<change>Remember smiles or bbcodes position after refresh page.</change>
					<change>New code in the mChat AJAX JavaScript file.</change>
					<change>All JavaScript files are compressed.</change>
					<change>Added the ability to mute the sound.</change>
					<change>Other minor changes.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-05-09</date>
				<rev-version>1.2.5</rev-version>
				<changelog lang="en">
					<change>IE console error fix.</change>
					<change>Fixed a bug where the chat is disabled and it makes requests to the database (SQL).</change>
					<change>Fixed message limit in edit mode.</change>
					<change>Added the chat on mchat.php page (custom page).</change>
					<change>Smiles fix.</change>
					<change>Added the ability to disable the archive for users/guest.</change>
					<change>Many other changes.</change>
					<change>Compatible with AutoMOD.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-05-22</date>
				<rev-version>1.2.6</rev-version>
				<changelog lang="en">
					<change>Added a limit on the maximum number of word characters in one message.</change>
					<change>Added cleaner for messages (only for founder).</change>
					<change>Corrected a few errors in JavaScript file.</change>
					<change>Added the ability to change the date format.</change>
					<change>Added Spanish language thanks to Ahri89.</change>
					<change>Added Polish language thanks to napus.</change>
					<change>Fixed header status problem in Opera browser.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-08-13</date>
				<rev-version>1.2.6a</rev-version>
				<changelog lang="en">
					<change>Changed Authors, added contributor.  Mod taken over by group @ phpbb3bbcodes.com</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-08-19</date>
				<rev-version>1.2.6b</rev-version>
				<changelog lang="en">
					<change>UMIL!!  Group/user permissions and config entries added install/uninstall removed from mchat.php.  Added lang file info_acp_mchat.php for auto inclusion into ACP.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-08-20</date>
				<rev-version>1.2.7</rev-version>
				<changelog lang="en">
					<change>ACP module written</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-08-21</date>
				<rev-version>1.2.8</rev-version>
				<changelog lang="en">
					<change>HTML files and css changed to better fit forum layout.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-08-23</date>
				<rev-version>1.2.9</rev-version>
				<changelog lang="en">
					<change>ACP module re-written</change>
				</changelog>
			</entry>			
			<entry>
				<date>2009-08-27</date>
				<rev-version>1.2.10</rev-version>
				<changelog lang="en">
					<change>Major rewrite of mchat.php file for use of proper authorizations, popup of IP address.  Added entry for viewonline.php.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-08-29</date>
				<rev-version>1.2.10a</rev-version>
				<changelog lang="en">
					<change>Corrected DIY instructions.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-08-29</date>
				<rev-version>1.2.11</rev-version>
				<changelog lang="en">
					<change>Added prune feature.  Fixed prosilver html file for missing "font size" language.  Fix for IE8 bbcode button issue.  Corrections to xml install files.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-08-31</date>
				<rev-version>1.2.12</rev-version>
				<changelog lang="en">
					<change>Fixed prune feature.  Corrected ACP Admin Log entry.  Added ability to change location of chat in ACP.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-09-04</date>
				<rev-version>1.2.13</rev-version>
				<changelog lang="en">
					<change>Fixed empty message if user only inputs bbcodes.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-09-09</date>
				<rev-version>1.2.14</rev-version>
				<changelog lang="en">
					<change>Added refresh of "Who is Chatting" stats, link in mchat area for editing users permissions (for banning).</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-09-10</date>
				<rev-version>1.2.15</rev-version>
				<changelog lang="en">
					<change>Whois Refresh in ACP.  Text area for disallowed bbcodes, other minutia.</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-10-06</date>
				<rev-version>1.2.16</rev-version>
				<changelog lang="en">
					<change>MOD Validation corrections.  Ability to allow mchat on index page or not via ACP.  Updated xsl to 1.2.23</change>
				</changelog>
			</entry>
			<entry>
				<date>2009-11-04</date>
				<rev-version>1.2.17</rev-version>
				<changelog lang="en">
					<change>Fixed update instructions from 1.2.15 to 1.2.16 as well as permissions in mchat.php</change>
				</changelog>
			</entry>			
		</history>
		<link-group>
			<link type="template" href="./contrib/subsilver2.xml" lang="en">SubSilver2</link>
			<link type="template" href="./contrib/update_mchat_126_1210.xml" lang="en">Update from 1.2.6 to 1.2.10a</link>
			<link type="template" href="./contrib/update_mchat_1210_1211.xml" lang="en">Update from 1.2.10a to 1.2.11</link>
			<link type="template" href="./contrib/update_mchat_1211_1212.xml" lang="en">Update from 1.2.11 to 1.2.12</link>
			<link type="template" href="./contrib/update_mchat_1212_1214.xml" lang="en">Update from 1.2.12 to 1.2.14</link>
			<link type="template" href="./contrib/update_mchat_1214_1215.xml" lang="en">Update from 1.2.14 to 1.2.15</link>
			<link type="template" href="./contrib/update_mchat_1215_1216.xml" lang="en">Update from 1.2.15 to 1.2.16</link>
			<link type="template" href="./contrib/update_mchat_1216_1217.xml" lang="en">Update from 1.2.16 to 1.2.17</link>			
			<link type="template" href="./contrib/notification_new_topics.xml" lang="en">New Topic Notification Add-on</link>
		</link-group>
	</header>
	<action-group>
		<copy>
			<file from="root/mchat.php" to="mchat.php" />
			<file from="root/mchat_install.php" to="mchat_install.php" />			
			<file from="root/mchat/*.*" to="mchat/*.*" />
			<file from="root/umil/*.*" to="umil/*.*" />
			<file from="root/includes/*.*" to="includes/*.*" />
			<file from="root/styles/prosilver/template/mchat_body.html" to="styles/prosilver/template/mchat_body.html" />
			<file from="root/language/en/*.*" to="language/en/*.*" />
			<file from="root/adm/*.*" to="adm/*.*" />
		</copy>
		<open src="index.php">
			<edit>
				<find><![CDATA[// Output page
page_header($user->lang['INDEX']);]]></find>
				<action type="before-add"><![CDATA[// BEGIN mChat Mod
if(!defined('MCHAT_INCLUDE') && $config['mchat_on_index'] && $config['mchat_enable'] && $auth->acl_get('u_mchat_view'))
{
	define('MCHAT_INCLUDE', true);
	$mchat_include_index = true;
	include($phpbb_root_path.'mchat.'.$phpEx);
}
// END mChat Mod]]></action>
			</edit>
		</open>
		<open src="viewonline.php">
			<edit>
				<find><![CDATA[			$location_url = append_sid("{$phpbb_root_path}index.$phpEx");
		break;]]></find>
				<action type="after-add"><![CDATA[		
// BEGIN mChat Mod		
		case 'mchat':
			$location = $user->lang['MCHAT'];
			$location_url = append_sid("{$phpbb_root_path}mchat.$phpEx");
		break;		
// END mChat Mod
]]></action>
			</edit>
		</open>			
		<open src="includes/constants.php">
			<edit>
				<find><![CDATA[// Additional tables]]></find>
				<action type="after-add"><![CDATA[// BEGIN mChat Mod
define('MCHAT_TABLE',				$table_prefix . 'mchat');
define('MCHAT_CONFIG_TABLE',		$table_prefix . 'mchat_config');
// END mChat Mod]]></action>
			</edit>
		</open>
		<open src="includes/functions.php">
			<edit>
				<find><![CDATA[		'U_FAQ'					=> append_sid("{$phpbb_root_path}faq.$phpEx"),]]></find>
				<action type="after-add"><![CDATA[// BEGIN mChat Mod
		'U_MCHAT'			=> $auth->acl_get('u_mchat_view') ? append_sid("{$phpbb_root_path}mchat.$phpEx") : '',
		'S_MCHAT_ON_INDEX'		=> $config['mchat_on_index'] ? true : false,
		'S_MCHAT_ENABLE'		=> ($config['mchat_enable'] && $auth->acl_get('u_mchat_view')) ? true : false,
// END mChat Mod]]></action>
			</edit>
		</open>
		<open src="language/en/common.php">
			<edit>
				<find><![CDATA[?>]]></find>
				<action type="before-add"><![CDATA[// BEGIN mChat Mod
$lang = array_merge($lang, array(
	'MCHAT'			=> 'Chat',
	'MCHAT_COPYRIGHT'	=> '&copy; <a href="http://www.phpbb3bbcodes.com/">phpBB3BBCodes.com</a>',
));
// END mChat Mod]]></action>
			</edit>
		</open>
		<open src="language/en/acp/common.php">
			<edit>
				<find><![CDATA[?>]]></find>
				<action type="before-add"><![CDATA[// BEGIN mChat Mod
$lang = array_merge($lang, array(
	// Prune Feature
	'LOG_MCHAT_TABLE_PRUNED'	=> 'mChat Table was pruned',
));
// END mChat Mod]]></action>
			</edit>
		</open>		
		<open src="styles/prosilver/template/editor.js">
			<edit>
				<find><![CDATA[
				textarea.focus();
				baseHeight = doc.selection.createRange().duplicate().boundingHeight;
				]]></find>
				<action type="replace-with"><![CDATA[
				/* === mChat focus fix Start === */
				var mChatFocus = window.mChatFocusFix || false;
				if(!mChatFocus)
				{
					textarea.focus();
				}
				baseHeight = doc.selection.createRange().duplicate().boundingHeight;
				/* ==== mChat focus fix End ==== */
			]]></action>
			</edit>
			<edit>
				<find><![CDATA[		for (sel_start = 0; range_all.compareEndPoints('StartToStart', range) < 0; sel_start++)]]></find>
					<action type="before-add"><![CDATA[try
		{]]></action>
			</edit>
			<edit>
				<find><![CDATA[		caretPos.end = txtarea.sel_start;]]></find>
				<action type="after-add"><![CDATA[}
		catch(e)
		{
		}]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/index_body.html">
			<edit>
				<find><![CDATA[<!-- INCLUDE forumlist_body.html -->]]></find>
				<action type="before-add"><![CDATA[<!-- IF S_MCHAT_ENABLE and S_MCHAT_ON_INDEX and S_MCHAT_LOCATION --><!-- INCLUDE mchat_body.html --><!-- ENDIF -->]]></action>
				<action type="after-add"><![CDATA[<!-- IF S_MCHAT_ENABLE and S_MCHAT_ON_INDEX and not S_MCHAT_LOCATION --><!-- INCLUDE mchat_body.html --><!-- ENDIF -->]]></action>
			</edit>			
		</open>		
		<open src="styles/prosilver/template/overall_header.html">
			<edit>
				<find><![CDATA[</head>]]></find>
				<action type="before-add"><![CDATA[<!-- IF S_MCHAT_ENABLE -->
<script type="text/javascript" src="{ROOT_PATH}mchat/jquery_core_mini.js"></script>
<script type="text/javascript" src="{ROOT_PATH}mchat/jquery_cookie_mini.js"></script>
<link rel="stylesheet" href="{ROOT_PATH}mchat/mchat_prosilver.css" type="text/css" />
<!-- ENDIF -->]]></action>
			</edit>
			<edit>
				<find><![CDATA[				<li class="icon-faq"><a href="{U_FAQ}" title="{L_FAQ_EXPLAIN}">{L_FAQ}</a></li>]]></find>
				<action type="after-add"><![CDATA[				<!-- IF S_MCHAT_ENABLE and U_MCHAT --><li class="icon-bump"><a href="{U_MCHAT}" title="{L_MCHAT}">{L_MCHAT}</a></li><!-- ENDIF -->]]></action>
			</edit>
		</open>	
<diy-instructions lang="en"><![CDATA[1. Browse to the file mchat_install.php in the root of your forum to make the database changes.
2. Delete the mchat_install.php file from the root of your forum.
3. Make all edits to all files and upload them to your forum.    
4. Refresh the styles in the ACP, set the settings for the Mini Chat under the ".MODS" tab.  
5. Then visit user/group permissions and set the permissions for the Mini Chat for your groups/users.  
6. Enjoy the Mod!!
]]></diy-instructions>
</action-group>
</mod>