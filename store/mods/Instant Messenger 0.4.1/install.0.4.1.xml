<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<?xml-stylesheet type="text/xsl" href="modx.prosilver.en.xsl"?>
<!--NOTICE: Please open this file in your web browser. If presented with a security warning, you may safely tell it to allow the blocked content.-->
<!--For security purposes, please check: http://www.phpbb.com/mods/ for the latest version of this MOD.\nAlthough MODs are checked before being allowed in the MODs Database there is no guarantee that there are no security problems within the MOD.\nNo support will be given for MODs not found within the MODs Database which can be found at http://www.phpbb.com/mods/-->
<mod xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.phpbb.com/mods/xml/modx-1.2.5.xsd">
	<meta name="generator" content="MODX file generated by MODX Generator by tumba25"/>
	<header>
		<license><![CDATA[http://opensource.org/licenses/gpl-license.php GNU General Public License v2]]></license>
		<title lang="en"><![CDATA[Facebook chat and user status with fixed bottom bar]]></title>
		<description lang="en"><![CDATA[This Chat / IM is based on php and jQuery. The Instant Messenger looks like facebook chat and has many features (check features). The part of this MOD is also User status with the idea similar to facebook status. This MOD has also next features like New posts on index etc. (check features list)]]></description>
		<author-notes lang="en"><![CDATA[Chat Features:
- online list with avatar and status of user (online or away)
- chat is similar to facebook chat
- possibility to collapse chat
- chating with offline users (message will be read when user log in)
- add a sound when a message arrives (in progress)

Bottom bar:
- online list with avatar and status of user (online or away)
- user status like facebook status (displayed on view profile and view topic)
- login / logout box
- google and board search box
- last x posts box
- private messages box
]]></author-notes>
		<author-group>
			<author>
				<username><![CDATA[Kamahl19]]></username>
				<homepage><![CDATA[www.phpbb3hacks.com]]></homepage>
				<email><![CDATA[kamahl19@gmail.com]]></email>
			</author>
			<author>
				<username><![CDATA[Culprit]]></username>
				<homepage><![CDATA[www.phpbb3hacks.com]]></homepage>
			</author>
		</author-group>
		<mod-version>0.4.1</mod-version>
		<installation>
			<level>intermediate</level>
			<time>600</time>
			<target-version>3.0.7-PL1</target-version>
		</installation>
		<history>
			<entry>
				<date>2010-05-17</date>
				<rev-version>0.4.1</rev-version>
				<changelog lang="en">
					<change><![CDATA[RTL support]]></change>
					<change><![CDATA[page load improved]]></change>
					<change><![CDATA[Some small fix]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2010-04-30</date>
				<rev-version>0.4.0</rev-version>
				<changelog lang="en">
					<change><![CDATA[rebuild user status]]></change>
					<change><![CDATA[files renamed to "instant_messenger"]]></change>
					<change><![CDATA[improved some chat functions]]></change>
					<change><![CDATA[chat rebuild from username to user id, allows to chat usernames with space]]></change>
					<change><![CDATA[fixed some bugs]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2010-04-17</date>
				<rev-version>0.3.0</rev-version>
				<changelog lang="en">
					<change><![CDATA[added User status (users can have their personal statuses displayed in profile and viewtopic)]]></change>
					<change><![CDATA[replace "chat" words with the "im" because of compatibility with other chat modifications]]></change>
					<change><![CDATA["Chat with" button also in user profile]]></change>
					<change><![CDATA[added nice jQuery effects]]></change>
					<change><![CDATA[fixed some bugs]]></change>
					<change><![CDATA[reworked bottom bar]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2010-04-15</date>
				<rev-version>0.2.0</rev-version>
				<changelog lang="en">
					<change><![CDATA[improved login / logout box]]></change>
					<change><![CDATA[added Google and board search box]]></change>
					<change><![CDATA[added Last x posts box]]></change>
					<change><![CDATA[added Private messages box]]></change>
					<change><![CDATA[fixed some html / css bugs]]></change>
					<change><![CDATA[added subsilver2 install file]]></change>
					<change><![CDATA[fixed sessions bugs]]></change>
					<change><![CDATA[fixed problems with IDs]]></change>
					<change><![CDATA[excluded bots from online list]]></change>
					<change><![CDATA[added default avatar image]]></change>
					<change><![CDATA[less SQL load]]></change>
				</changelog>
			</entry>
			<entry>
				<date>2010-03-02</date>
				<rev-version>0.1.0</rev-version>
				<changelog lang="en">
					<change><![CDATA[initial release]]></change>
				</changelog>
			</entry>
		</history>
		<link-group>
			<link type="template" href="./contrib/subsilver2.xml" lang="en">subsilver2</link>
		</link-group>
	</header>
	<action-group>
		<sql>DROP TABLE IF EXISTS `phpbb_im`;
CREATE TABLE IF NOT EXISTS `phpbb_im` (
  `from` mediumint(8) NOT NULL,
  `to` mediumint(8) NOT NULL,
  `message` text collate utf8_bin NOT NULL,
  `sent` int(11) NOT NULL,
  `recd` tinyint(1) unsigned NOT NULL default '0',
  KEY `sent` (`sent`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_bin;

DROP TABLE IF EXISTS `phpbb_users_im`;
CREATE TABLE IF NOT EXISTS `phpbb_users_im` (
  `user_id` mediumint(9) NOT NULL,
  `user_status` varchar(1024) default NULL,
  `user_deny_im` tinyint(1) default '0',
  `user_sound_im` tinyint(1) NOT NULL default '1',
  PRIMARY KEY  (`user_id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;

INSERT INTO `phpbb_config` (config_name, config_value, is_dynamic) VALUES ( 'im_disable', '0', 1);
INSERT INTO `phpbb_config` (config_name, config_value, is_dynamic) VALUES ( 'im_only_friends', '1', 1);
INSERT INTO `phpbb_config` (config_name, config_value, is_dynamic) VALUES ( 'im_allow_sound', '1', 1);
INSERT INTO `phpbb_config` (config_name, config_value, is_dynamic) VALUES ( 'im_override_cfg', '1', 1);
</sql>
		<copy>
			<file from="root/includes/hooks/hook_instant_messenger.php" to="includes/hooks/hook_instant_messenger.php"/>
			<file from="root/instant_messenger.php" to="instant_messenger.php"/>
			<file from="root/styles/instant_messenger/im-new-message.mp3" to="styles/instant_messenger/im-new-message.mp3"/>
			<file from="root/styles/instant_messenger/index.html" to="styles/instant_messenger/index.html"/>
			<file from="root/styles/instant_messenger/instant_messenger.js" to="styles/instant_messenger/instant_messenger.js"/>
			<file from="root/styles/instant_messenger/instant_messenger_buttons.js" to="styles/instant_messenger/instant_messenger_buttons.js"/>
			<file from="root/styles/instant_messenger/jquery.dbj_sound.js" to="styles/instant_messenger/jquery.dbj_sound.js"/>
			<file from="root/styles/instant_messenger/jquery.hoverIntent.min.js" to="styles/instant_messenger/jquery.hoverIntent.min.js"/>
			<file from="root/styles/prosilver/template/instant_messenger_bar.html" to="styles/prosilver/template/instant_messenger_bar.html"/>
			<file from="root/styles/prosilver/template/instant_messenger_newposts.html" to="styles/prosilver/template/instant_messenger_newposts.html"/>
			<file from="root/styles/prosilver/template/instant_messenger_online_body.html" to="styles/prosilver/template/instant_messenger_online_body.html"/>
			<file from="root/styles/prosilver/template/instant_messenger_update_browser.html" to="styles/prosilver/template/instant_messenger_update_browser.html"/>
			<file from="root/styles/prosilver/theme/images/im_away.gif" to="styles/prosilver/theme/images/im_away.gif"/>
			<file from="root/styles/prosilver/theme/images/im_list_offline.gif" to="styles/prosilver/theme/images/im_list_offline.gif"/>
			<file from="root/styles/prosilver/theme/images/im_list_online.gif" to="styles/prosilver/theme/images/im_list_online.gif"/>
			<file from="root/styles/prosilver/theme/images/im_no_avatar.gif" to="styles/prosilver/theme/images/im_no_avatar.gif"/>
			<file from="root/styles/prosilver/theme/images/im_offline.gif" to="styles/prosilver/theme/images/im_offline.gif"/>
			<file from="root/styles/prosilver/theme/images/im_online.gif" to="styles/prosilver/theme/images/im_online.gif"/>
			<file from="root/styles/prosilver/theme/images/im_text.gif" to="styles/prosilver/theme/images/im_text.gif"/>
			<file from="root/styles/prosilver/theme/images/im_toolbarbg.gif" to="styles/prosilver/theme/images/im_toolbarbg.gif"/>
			<file from="root/styles/prosilver/theme/images/mail.gif" to="styles/prosilver/theme/images/mail.gif"/>
			<file from="root/styles/prosilver/theme/images/mail_new.gif" to="styles/prosilver/theme/images/mail_new.gif"/>
			<file from="root/styles/prosilver/theme/images/new_posts.gif" to="styles/prosilver/theme/images/new_posts.gif"/>
			<file from="root/styles/prosilver/theme/images/search.gif" to="styles/prosilver/theme/images/search.gif"/>
			<file from="root/styles/prosilver/theme/images/status_down.gif" to="styles/prosilver/theme/images/status_down.gif"/>
			<file from="root/styles/prosilver/theme/images/status_up.gif" to="styles/prosilver/theme/images/status_up.gif"/>
			<file from="root/styles/prosilver/theme/instant_messenger.css" to="styles/prosilver/theme/instant_messenger.css"/>
			<file from="root/styles/prosilver/theme/instant_messenger_bidi.css" to="styles/prosilver/theme/instant_messenger_bidi.css"/>
			<file from="root/styles/prosilver/theme/instant_messenger_ie.css" to="styles/prosilver/theme/instant_messenger_ie.css"/>
		</copy>
		<open src="common.php">
			<edit>
				<find><![CDATA[	@include($phpbb_root_path . 'includes/hooks/' . $hook . '.' . $phpEx);
}]]></find>
				<action type="after-add"><![CDATA[
include_once( $phpbb_root_path . 'instant_messenger.' . $phpEx);]]></action>
			</edit>
		</open>
		<open src="includes/constants.php">
			<edit>
				<find><![CDATA[// Additional tables]]></find>
				<action type="after-add"><![CDATA[// MOD :: INSTANT MESSENGER -- START
define('IM_TABLE',					$table_prefix . 'im');
define('USERS_IM_TABLE',			$table_prefix . 'users_im');

// MOD :: INSTANT MESSENGER -- END]]></action>
			</edit>
		</open>
		<open src="includes/functions.php">
			<edit>
				<find><![CDATA[		'SITE_LOGO_IMG'			=> $user->img('site_logo'),]]></find>
				<action type="after-add"><![CDATA[		// MOD :: INSTANT MESSENGER -- START
		'S_SERVER_NAME'			=> $config['server_name'], 
		'S_USER_STATUS'			=> $user->data['user_status'],
		'S_ALLOW_IM'			=> $config['im_disable'] == 0 ? true : false,
		'S_USER_ALLOW_IM'		=> $config['im_disable'] == 1 ? false : ( $config['im_override_cfg'] == 1 ? true : ( $user->data['user_deny_im'] == 0 ? true : false)), 
		'S_USER_IM_SOUND'		=> $config['im_override_cfg'] == 1 ? ( $config['im_allow_sound'] == 1 ? '1' : '0') : ( $user->data['user_sound_im'] == 1 ? '1' : '0') ,
		'U_COMPOSE_NEW'			=> append_sid("{$phpbb_root_path}ucp.$phpEx", 'i=pm&amp;mode=compose'), 
		'U_OUTBOX'				=> append_sid("{$phpbb_root_path}ucp.$phpEx", 'i=pm&amp;folder=outbox'),     
		'U_SENT_MESSAGES'		=> append_sid("{$phpbb_root_path}ucp.$phpEx", 'i=pm&amp;folder=sentbox'),
		'U_MANAGE_FRIENDS'		=> append_sid("{$phpbb_root_path}ucp.$phpEx", 'i=zebra&amp;mode=friends'),
		'U_MANAGE_BOOKMARKS'	=> append_sid("{$phpbb_root_path}ucp.$phpEx", 'i=main&amp;mode=bookmarks'),
		'U_ACCOUNT_SETTINGS'	=> append_sid("{$phpbb_root_path}ucp.$phpEx", 'i=profile'),
		// MOD :: INSTANT MESSENGER -- END
	]]></action>
			</edit>
		</open>
		<open src="language/en/common.php">
			<edit>
				<find><![CDATA[	'default_dateformat'	=> 'D M d, Y g:i a', // Mon Jan 01, 2007 1:37 pm]]></find>
				<action type="after-add"><![CDATA[	/*
	 * INSTANT MESSANGER -- START
	 */
	
	'IM'						=> 'Chat',
	'IM_NOT_LOGGED_IN'			=> 'Guests can not chat',
	'IM_SENT'					=> 'Sent at ',
	'START_IM'					=> 'Open chat',
	'IM_WITH'					=> 'Chat with',
	'GOOGLE_SEARCH'			=> 'Google search',
 	'BOARD_SEARCH'			=> 'Board search',
	'REMEMBER_ME'			=> 'Remember me',
	'BY'			=> 'by',
	'COMPOSE_MESSAGE'			=> 'Compose new message',
	'INBOX'			=> 'Go to your Inbox',
	'OUTBOX'			=> 'Go to your Outbox',
	'SENT_MESSAGES'			=> 'Go to your Sent messages',
	'UPDATE_STATUS'				=> 'Update status',
	'STATUS_ADDED'				=> 'Status has been updated.',
	'STATUS_DELETED'				=> 'Status has been removed.',
	'ACCOUNT'        => 'Account',
	'MANAGE_FRIENDS'        => 'Manage friends',
	'MANAGE_BOOKMARKS'        => 'Manage bookmarks',
	'ACCOUNT_SETTINGS'        => 'Account settings',
	'COULD_NOT_OBTAIN_ONLINE_USER_LIST'  => 'Could not obtain online users list',
	'IM_UPDATE_BROSWER' =>  'Update browser',
	'INSTALL' =>  'Install',
	'TELL_ME_MORE' =>  'Tell me more',
	/*
	 * INSTANT MESSANGER -- END
	 */	]]></action>
			</edit>
		</open>
		<open src="memberlist.php">
			<edit>
				<find><![CDATA[			$member['posts_in_queue'] = 0;
		}]]></find>
				<action type="after-add"><![CDATA[		// MOD :: INSTANT MESSENGER -- START
		$sql = 'SELECT user_status, user_deny_im
			FROM ' . USERS_IM_TABLE . '
			WHERE user_id = ' . $user_id;
		$result = $db->sql_query( $sql);
		$row = $db->sql_fetchrow( $result);
		if ( !is_array( $row))
		{
			$row = array(
				'user_status'	=> '',
				'user_deny_im'	=> 0
			);
		}
		$member = array_merge( $member, $row);
		$db->sql_freeresult( $result);
		
		$template->assign_vars(array(
			'USER_STATUS'		=> $member['user_status'],
			'USER_ID'			=> $user_id,
			'S_ALLOW_IM'		=> $user_id != $user->data['user_id'] && $member['user_deny_im'] == 0,
			'S_CAN_WITH_IM'		=> $friend, 
		));
		// MOD :: INSTANT MESSENGER -- END
		]]></action>
			</edit>
			<edit>
				<find><![CDATA[					$cp_row = (isset($profile_fields_cache[$user_id])) ? $cp->generate_profile_fields_template('show', false, $profile_fields_cache[$user_id]) : array();
				}]]></find>
				<action type="after-add"><![CDATA[				// MOD :: INSTANT MESSENGER -- START
				$sql = "SELECT uim.user_deny_im, z.friend
						FROM " . USERS_IM_TABLE . " uim RIGHT OUTER JOIN " . ZEBRA_TABLE . " z ON z.user_id = uim.user_id
						WHERE uim.user_id = " . $user_id . "
							AND z.zebra_id = " . $user->data['user_id'] . "
							AND z.user_id = " . $user_id;
				$result = $db->sql_query( $sql);
				$im_row = $db->sql_fetchrow( $result);
				$row['user_deny_im'] = (int) $im_row['user_deny_im'];
				$row['friend'] =  ((int) $im_row['friend'] == 1 ) ? true : false;
				//if ( $user_id == 2) {print_r( $im_row);die( $row);}
				$db->sql_freeresult( $result);
				// MOD :: INSTANT MESSENGER -- END
				
				]]></action>
			</edit>
			<edit>
				<find><![CDATA[					'S_GROUP_LEADER'	=> $is_leader,]]></find>
				<action type="after-add"><![CDATA[					// MOD :: INSTANT MESSENGER -- START
					'S_ALLOW_IM'		=> $row['user_deny_im'] == 0 && $user->data['user_id'] != $user_id,
					'S_CAN_WITH_IM'		=> $row['friend'] ? true : false,
					// MOD :: INSTANT MESSENGER -- END]]></action>
			</edit>
			<edit>
				<find><![CDATA[			'U_LIST_CHAR'			=> $sort_url . '&amp;sk=a&amp;sd=' . (($sort_key == 'l' && $sort_dir == 'a') ? 'd' : 'a'),]]></find>
				<action type="after-add"><![CDATA[			// MOD :: INSTANT MESSENGER -- START
			'USER_ID'			=> $user->data['user_id'],
			// MOD :: INSTANT MESSENGER -- END]]></action>
			</edit>
			<edit>
				<find><![CDATA[	return array(]]></find>
				<action type="after-add"><![CDATA[		// MOD :: INSTANT MESSENGER -- START
		'USER_ID'		=> $user_id,
		// MOD :: INSTANT MESSENGER -- END]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/memberlist_body.html">
			<edit>
				<find><![CDATA[			<th class="info"><a href="{U_SORT_WEBSITE}#memberlist">{L_WEBSITE}</a>{L_COMMA_SEPARATOR}<a href="{U_SORT_LOCATION}">{L_LOCATION}</a></th>]]></find>
				<inline-edit>
					<inline-find><![CDATA[			<th class="info"]]></inline-find>
					<inline-action type="after-add"><![CDATA[><!-- IF S_USER_ALLOW_IM --><span class="rightside">{L_IM}</span><!-- ENDIF --]]></inline-action>
				</inline-edit>
			</edit>
			<edit>
				<find><![CDATA[			<th class="info"><a href="{U_SORT_WEBSITE}#memberlist">{L_WEBSITE}</a>{L_COMMA_SEPARATOR}<a href="{U_SORT_LOCATION}">{L_LOCATION}</a></th>]]></find>
				<inline-edit>
					<inline-find><![CDATA[			<th class="info"]]></inline-find>
					<inline-action type="after-add"><![CDATA[><!-- IF S_USER_ALLOW_IM --><span class="rightside">{L_IM}</span><!-- ENDIF --]]></inline-action>
				</inline-edit>
			</edit>
			<edit>
				<find><![CDATA[		<td class="info"><!-- IF memberrow.U_WWW or memberrow.LOCATION --><!-- IF memberrow.U_WWW --><div><a href="{memberrow.U_WWW}" title="{L_VISIT_WEBSITE}: {memberrow.U_WWW}">{memberrow.U_SHORT_WWW}</a></div><!-- ENDIF --><!-- IF memberrow.LOCATION --><div>{memberrow.LOCATION}</div><!-- ENDIF --><!-- ELSE -->&nbsp;<!-- ENDIF --></td>]]></find>
				<inline-edit>
					<inline-find><![CDATA[		<td class="info"]]></inline-find>
					<inline-action type="after-add"><![CDATA[><!-- IF S_USER_ALLOW_IM and memberrow.S_ALLOW_IM and memberrow.S_CAN_WITH_IM --><span class="rightside"><a href="#" onclick="javascript:chatWith('{memberrow.USER_ID}','{memberrow.USERNAME}')"><img src="{T_THEME_PATH}/images/im_text.gif" style="height:12px;width:14px;" /></a></span><!-- ENDIF --]]></inline-action>
				</inline-edit>
			</edit>
		</open>
		<open src="styles/prosilver/template/memberlist_view.html">
			<edit>
				<find><![CDATA[		</dd>]]></find>
				<action type="after-add"><![CDATA[		<!-- IF USER_STATUS neq '' -->
		<dt>&nbsp;</dt>
		<dd>
			<div class="bubble">
				<cite>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</cite>
				<blockquote>
					<p>{USER_STATUS}</p>
				</blockquote>
			</div>
		</dd>
		<!-- ENDIF -->]]></action>
			</edit>
			<edit>
				<find><![CDATA[		<!-- IF U_PM --><dt>{L_PM}:</dt> <dd><a href="{U_PM}">{L_SEND_PRIVATE_MESSAGE}</a></dd><!-- ENDIF -->]]></find>
				<action type="after-add"><![CDATA[		<!-- IF S_USER_ALLOW_IM and S_ALLOW_IM and U_REMOVE_FRIEND --><dt>{L_IM}:</dt> <dd><a href="#" onclick="javascript:chatWith('{USER_ID}', '{USERNAME}')">{L_IM_WITH} {USERNAME}</a></dd><!-- ENDIF -->]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/overall_footer.html">
			<edit>
				<find><![CDATA[<div class="copyright">Powered by <a href="http://www.phpbb.com/">phpBB</a> &copy; 2000, 2002, 2005, 2007 phpBB Group]]></find>
				<inline-edit>
					<inline-action type="after-add"><![CDATA[, Instant Messenger and user status created by <a href="http://www.phpbb3hacks.com" title="phpbb3 modifications">phpbb3hacks.com</a>]]></inline-action>
				</inline-edit>
			</edit>
		</open>
		<open src="styles/prosilver/template/overall_header.html">
			<edit>
				<find><![CDATA[<title>{SITENAME} &bull; <!-- IF S_IN_MCP -->{L_MCP} &bull; <!-- ELSEIF S_IN_UCP -->{L_UCP} &bull; <!-- ENDIF -->{PAGE_TITLE}</title>]]></find>
				<action type="after-add"><![CDATA[
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<!-- IF S_USER_ALLOW_IM -->
<!-- IF S_USER_LOGGED_IN and not S_IS_BOT --><script type="text/javascript" src="{ROOT_PATH}styles/instant_messenger/instant_messenger.js"></script><!-- ENDIF -->
<!-- IF not S_IS_BOT --><script type="text/javascript" src="{ROOT_PATH}styles/instant_messenger/instant_messenger_buttons.js"></script><!-- ENDIF -->
<!-- ENDIF -->]]></action>
			</edit>
			<edit>
				<find><![CDATA[	}]]></find>
				<action type="after-add"><![CDATA[<!-- IF S_USER_ALLOW_IM -->
	jQuery(document).ready( function() {
		load_startIM({
			rootPath: '{ROOT_PATH}',
			themePath: '{T_THEME_PATH}',
			enableSound: '{S_USER_IM_SOUND}' == '1' ? true : false,
			rtl: '{S_CONTENT_DIRECTION}'
		});
	});
<!-- ENDIF -->]]></action>
			</edit>
			<edit>
				<find><![CDATA[<link href="{T_STYLESHEET_LINK}" rel="stylesheet" type="text/css" media="screen, projection" />]]></find>
				<action type="after-add"><![CDATA[<!--[if lt IE 7]>
  <link href="{T_THEME_PATH}/instant_messenger_ie.css" rel="stylesheet" media="all" type="text/css"  />
<![endif]-->]]></action>
			</edit>
			<edit>
				<find><![CDATA[	<link href="{T_THEME_PATH}/bidi.css" rel="stylesheet" type="text/css" media="screen, projection" />]]></find>
				<action type="after-add"><![CDATA[	<!-- IF S_USER_ALLOW_IM --><link href="{T_THEME_PATH}/instant_messenger_bidi.css" rel="stylesheet" type="text/css" media="screen, projection" /><!-- ENDIF -->]]></action>
			</edit>
			<edit>
				<find><![CDATA[<body id="phpbb" class="section-{SCRIPT_NAME} {S_CONTENT_DIRECTION}">]]></find>
				<action type="after-add"><![CDATA[<!-- IF S_USER_ALLOW_IM and not S_IS_BOT -->
	<!-- INCLUDE instant_messenger_bar.html -->
<!-- ENDIF --> ]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/template/viewtopic_body.html">
			<edit>
				<find><![CDATA[		<dd>&nbsp;</dd>]]></find>
				<action type="after-add"><![CDATA[		<!-- IF postrow.S_STATUS neq '' -->
			<div class="bubble">
				<cite>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</cite>
				<blockquote>
					<p>{postrow.S_STATUS}</p>
				</blockquote>
			</div>

		<!-- ENDIF -->]]></action>
			</edit>
		</open>
		<open src="styles/prosilver/theme/stylesheet.css">
			<edit>
				<find><![CDATA[@import url("colours.css");]]></find>
				<action type="after-add"><![CDATA[
@import url("instant_messenger.css");]]></action>
			</edit>
		</open>
		<open src="viewtopic.php">
			<edit>
				<find><![CDATA[	'SELECT'	=> 'u.*, z.friend, z.foe, p.*',]]></find>
				<inline-edit>
					<inline-find><![CDATA[	'SELECT'	=> 'u.*, z.friend, z.foe, p.*]]></inline-find>
					<inline-action type="after-add"><![CDATA[, uim.user_status]]></inline-action>
				</inline-edit>
			</edit>
			<edit>
				<find><![CDATA[			'ON'	=> 'z.user_id = ' . $user->data['user_id'] . ' AND z.zebra_id = p.poster_id']]></find>
				<action type="after-add"><![CDATA[		),
		array(
			'FROM'	=> array(USERS_IM_TABLE => 'uim'),
			'ON'	=> 'uim.user_id = p.poster_id' ]]></action>
			</edit>
			<edit>
				<find><![CDATA[		'foe'				=> $row['foe'],]]></find>
				<action type="after-add"><![CDATA[		'status'			=> $row['user_status'],]]></action>
			</edit>
			<edit>
				<find><![CDATA[				'allow_pm'			=> 0,]]></find>
				<action type="after-add"><![CDATA[			
				'status'			=> '',]]></action>
			</edit>
			<edit>
				<find><![CDATA[				'author_profile'	=> get_username_string('profile', $poster_id, $row['username'], $row['user_colour']),]]></find>
				<action type="after-add"><![CDATA[			
				'status'		=> ($row['user_status']) ? $row['user_status'] : '',]]></action>
			</edit>
			<edit>
				<find><![CDATA[		'U_JABBER'		=> $user_cache[$poster_id]['jabber'],]]></find>
				<action type="after-add"><![CDATA[		'S_STATUS'		=> $user_cache[$poster_id]['status'], ]]></action>
			</edit>
		</open>
	</action-group>
</mod>
