/*
 * CometChat 
 * Copyright (c) 2010 Inscripts - support@cometchat.com | http://www.cometchat.com | http://www.inscripts.com
*/

<?php if (defined('INCLUDE_CSS') && INCLUDE_CSS == 1) { ?>
	var cccss = document.createElement("link");
	cccss.type = "text/css";
	cccss.rel = "stylesheet";
	cccss.href = "<?php echo BASE_URL;?>cometchatcss.php";
	jqcc('body').append(cccss);
<?php } ?>


if(typeof(jqcc) === 'undefined') {
	jqcc = jQuery;
}

// Copyright (c) 2006 Klaus Hartl (stilbuero.de)
// http://www.opensource.org/licenses/mit-license.php

jqcc.cookie=function(a,b,c){if(typeof b!='undefined'){c=c||{};if(b===null){b='';c.expires=-1}var d='';if(c.expires&&(typeof c.expires=='number'||c.expires.toUTCString)){var e;if(typeof c.expires=='number'){e=new Date();e.setTime(e.getTime()+(c.expires*24*60*60*1000))}else{e=c.expires}d='; expires='+e.toUTCString()}var f=c.path?'; path='+(c.path):'';var g=c.domain?'; domain='+(c.domain):'';var h=c.secure?'; secure':'';document.cookie=[a,'=',encodeURIComponent(b),d,f,g,h].join('')}else{var j=null;if(document.cookie&&document.cookie!=''){var k=document.cookie.split(';');for(var i=0;i<k.length;i++){var l=jqcc.trim(k[i]);if(l.substring(0,a.length+1)==(a+'=')){j=decodeURIComponent(l.substring(a.length+1));break}}}return j}};

// SWFObject is (c) 2007 Geoff Stearns and is released under the MIT License
// http://www.opensource.org/licenses/mit-license.php

if(typeof deconcept=="undefined"){var deconcept=new Object();}if(typeof deconcept.util=="undefined"){deconcept.util=new Object();}if(typeof deconcept.SWFObjectCCUtil=="undefined"){deconcept.SWFObjectCCUtil=new Object();}deconcept.SWFObjectCC=function(_1,id,w,h,_5,c,_7,_8,_9,_a){if(!document.getElementById){return;}this.DETECT_KEY=_a?_a:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object();this.variables=new Object();this.attributes=new Array();if(_1){this.setAttribute("swf",_1);}if(id){this.setAttribute("id",id);}if(w){this.setAttribute("width",w);}if(h){this.setAttribute("height",h);}if(_5){this.setAttribute("version",new deconcept.PlayerVersion(_5.toString().split(".")));}this.installedVer=deconcept.SWFObjectCCUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObjectCC.doPrepUnload=true;}if(c){this.addParam("bgcolor",c);}var q=_7?_7:"high";this.addParam("quality",q);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var _c=(_8)?_8:window.location;this.setAttribute("xiRedirectUrl",_c);this.setAttribute("redirectUrl","");if(_9){this.setAttribute("redirectUrl",_9);}};deconcept.SWFObjectCC.prototype={useExpressInstall:function(_d){this.xiSWFPath=!_d?"expressinstall.swf":_d;this.setAttribute("useExpressInstall",true);},setAttribute:function(_e,_f){this.attributes[_e]=_f;},getAttribute:function(_10){return this.attributes[_10];},addParam:function(_11,_12){this.params[_11]=_12;},getParams:function(){return this.params;},addVariable:function(_13,_14){this.variables[_13]=_14;},getVariable:function(_15){return this.variables[_15];},getVariables:function(){return this.variables;},getVariablePairs:function(){var _16=new Array();var key;var _18=this.getVariables();for(key in _18){_16[_16.length]=key+"="+_18[key];}return _16;},getSWFHTML:function(){var _19="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath);}_19="<embed type=\"application/x-shockwave-flash\" src=\""+this.getAttribute("swf")+"\" width=\""+this.getAttribute("width")+"\" height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\"";_19+=" id=\""+this.getAttribute("id")+"\" name=\""+this.getAttribute("id")+"\" ";var _1a=this.getParams();for(var key in _1a){_19+=[key]+"=\""+_1a[key]+"\" ";}var _1c=this.getVariablePairs().join("&");if(_1c.length>0){_19+="flashvars=\""+_1c+"\"";}_19+="/>";}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath);}_19="<object id=\""+this.getAttribute("id")+"\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" width=\""+this.getAttribute("width")+"\" height=\""+this.getAttribute("height")+"\" style=\""+this.getAttribute("style")+"\">";_19+="<param name=\"movie\" value=\""+this.getAttribute("swf")+"\" />";var _1d=this.getParams();for(var key in _1d){_19+="<param name=\""+key+"\" value=\""+_1d[key]+"\" />";}var _1f=this.getVariablePairs().join("&");if(_1f.length>0){_19+="<param name=\"flashvars\" value=\""+_1f+"\" />";}_19+="</object>";}return _19;},write:function(_20){if(this.getAttribute("useExpressInstall")){var _21=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(_21)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var n=(typeof _20=="string")?document.getElementById(_20):_20;n.innerHTML=this.getSWFHTML();return true;}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"));}}return false;}};deconcept.SWFObjectCCUtil.getPlayerVersion=function(){var _23=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var x=navigator.plugins["Shockwave Flash"];if(x&&x.description){_23=new deconcept.PlayerVersion(x.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."));}}else{if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var axo=1;var _26=3;while(axo){try{_26++;axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+_26);_23=new deconcept.PlayerVersion([_26,0,0]);}catch(e){axo=null;}}}else{try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(e){try{var axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");_23=new deconcept.PlayerVersion([6,0,21]);axo.AllowScriptAccess="always";}catch(e){if(_23.major==6){return _23;}}try{axo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(e){}}if(axo!=null){_23=new deconcept.PlayerVersion(axo.GetVariable("$version").split(" ")[1].split(","));}}}return _23;};deconcept.PlayerVersion=function(_29){this.major=_29[0]!=null?parseInt(_29[0]):0;this.minor=_29[1]!=null?parseInt(_29[1]):0;this.rev=_29[2]!=null?parseInt(_29[2]):0;};deconcept.PlayerVersion.prototype.versionIsValid=function(fv){if(this.major<fv.major){return false;}if(this.major>fv.major){return true;}if(this.minor<fv.minor){return false;}if(this.minor>fv.minor){return true;}if(this.rev<fv.rev){return false;}return true;};deconcept.util={getRequestParameter:function(_2b){var q=document.location.search||document.location.hash;if(_2b==null){return q;}if(q){var _2d=q.substring(1).split("&");for(var i=0;i<_2d.length;i++){if(_2d[i].substring(0,_2d[i].indexOf("="))==_2b){return _2d[i].substring((_2d[i].indexOf("=")+1));}}}return "";}};deconcept.SWFObjectCCUtil.cleanupSWFs=function(){var _2f=document.getElementsByTagName("OBJECT");for(var i=_2f.length-1;i>=0;i--){_2f[i].style.display="none";for(var x in _2f[i]){if(typeof _2f[i][x]=="function"){_2f[i][x]=function(){};}}}};if(deconcept.SWFObjectCC.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectCCUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectCCUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",deconcept.SWFObjectCCUtil.prepUnload);deconcept.unloadSet=true;}}if(!document.getElementById&&document.all){document.getElementById=function(id){return document.all[id];};}var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObjectCC;var SWFObjectCC=deconcept.SWFObjectCC;


/**
 * Copyright (c) 2007-2009 Ariel Flesler - aflesler(at)gmail(dot)com
 * http://flesler.blogspot.com/2007/10/jqccscrollto.html
 */

(function($){var h=$.scrollToCC=function(a,b,c){$(window).scrollToCC(a,b,c)};h.defaults={axis:'xy',duration:parseFloat($.fn.jqcc)>=1.3?0:1};h.window=function(a){return $(window)._scrollable()};$.fn._scrollable=function(){return this.map(function(){var a=this,isWin=!a.nodeName||$.inArray(a.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!isWin)return a;var b=(a.contentWindow||a).document||a.ownerDocument||a;return $.browser.safari||b.compatMode=='BackCompat'?b.body:b.documentElement})};$.fn.scrollToCC=function(e,f,g){if(typeof f=='object'){g=f;f=0}if(typeof g=='function')g={onAfter:g};if(e=='max')e=9e9;g=$.extend({},h.defaults,g);f=f||g.speed||g.duration;g.queue=g.queue&&g.axis.length>1;if(g.queue)f/=2;g.offset=both(g.offset);g.over=both(g.over);return this._scrollable().each(function(){var d=this,$elem=$(d),targ=e,toff,attr={},win=$elem.is('html,body');switch(typeof targ){case'number':case'string':if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break}targ=$(targ,this);case'object':if(targ.is||targ.style)toff=(targ=$(targ)).offset()}$.each(g.axis.split(''),function(i,a){var b=a=='x'?'Left':'Top',pos=b.toLowerCase(),key='scroll'+b,old=d[key],max=h.max(d,a);if(toff){attr[key]=toff[pos]+(win?0:old-$elem.offset()[pos]);if(g.margin){attr[key]-=parseInt(targ.css('margin'+b))||0;attr[key]-=parseInt(targ.css('border'+b+'Width'))||0}attr[key]+=g.offset[pos]||0;if(g.over[pos])attr[key]+=targ[a=='x'?'width':'height']()*g.over[pos]}else{var c=targ[pos];attr[key]=c.slice&&c.slice(-1)=='%'?parseFloat(c)/100*max:c}if(/^\d+$/.test(attr[key]))attr[key]=attr[key]<=0?0:Math.min(attr[key],max);if(!i&&g.queue){if(old!=attr[key])animate(g.onAfterFirst);delete attr[key]}});animate(g.onAfter);function animate(a){$elem.animate(attr,f,g.easing,a&&function(){a.call(this,e,g)})}}).end()};h.max=function(a,b){var c=b=='x'?'Width':'Height',scroll='scroll'+c;if(!$(a).is('html,body'))return a[scroll]-$(a)[c.toLowerCase()]();var d='client'+c,html=a.ownerDocument.documentElement,body=a.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[d],body[d])};function both(a){return typeof a=='object'?a:{top:a,left:a}}})(jqcc);

<?php if (defined('USE_COMET') && USE_COMET == 1) { ?>
window['JSON']||(function(){window['JSON']={};function f(n){return n<10?'0'+n:n}if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+f(this.getUTCMonth()+1)+'-'+f(this.getUTCDate())+'T'+f(this.getUTCHours())+':'+f(this.getUTCMinutes())+':'+f(this.getUTCSeconds())+'Z':null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key)}if(typeof rep==='function'){value=rep.call(holder,key,value)}switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null'}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null'}v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v}if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==='string'){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v)}}}}v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v}}if(typeof JSON['stringify']!=='function'){JSON['stringify']=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' '}}else if(typeof space==='string'){indent=space}rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify')}return str('',{'':value})}}if(typeof JSON['parse']!=='function'){JSON['parse']=function(text,reviver){return eval('('+text+')')}}}());window['COMET']||(function(){var now=function(){return++NOW+''+(+new Date)},NOW=1,$=function(id){return document.getElementById(id)},log=function(message){},search=function(elements){var list=[];each(elements.split(/\s+/),function(el){each(document.getElementsByTagName(el),function(node){list.push(node)})});return list},each=function(o,f){if(!o||!f)return;if(typeof o[0]!='undefined')for(var i=0,l=o.length;i<l;)f.call(o[i],o[i],i++);else for(var i in o)o.hasOwnProperty&&o.hasOwnProperty(i)&&f.call(o[i],i,o[i])},walk=function(n,f){f.call(n,n);n=n.firstChild;while(n){walk(n,f);n=n.nextSibling}},map=function(list,fun){var fin=[];each(list||[],function(k,v){fin.push(fun(k,v))});return fin},grep=function(list,fun){var fin=[];each(list||[],function(l){fun(l)&&fin.push(l)});return fin},magic=/\$?{([\w\-]+)}/g,supplant=function(str,values){return str.replace(magic,function(_,match){return''+values[match]||''})},bind=function(type,el,fun){var rapfun=function(e){if(!e)var e=window.event;if(!fun(e)){e.cancelBubble=true;e.returnValue=false;if(e.stopPropagation){e.stopPropagation();e.preventDefault()}}};if(el.addEventListener)el.addEventListener(type,rapfun,false);else if(el.attachEvent)el.attachEvent('on'+type,rapfun);else el['on'+type]=rapfun},unbind=function(type,el,fun){if(el.removeEventListener)el.removeEventListener(type,false);else if(el.detachEvent)el.detachEvent('on'+type,false);else el['on'+type]=null},head=function(){return search('head')[0]},urlize=function(data,url){if(!data)return'';var params=[],key='';for(key in data)params.push(escape(key)+'='+escape(data[key]));return(url.indexOf('?')===-1?'?':'&')+params.join('&')},attr=function(node,attribute,value){if(value)node.setAttribute(attribute,value);else return node&&node.getAttribute&&node.getAttribute(attribute)},css=function(element,styles){for(var style in styles)if(styles.hasOwnProperty(style))try{element.style[style]=styles[style]+('|width|height|top|left|'.indexOf(style)>0?'px':'')}catch(e){}},create=function(element){return document.createElement(element)},parse=function(str){return JSON['parse'](str)},stringify=function(obj){return JSON['stringify'](obj)},ASYNC='async',XORIGN=0,xdr=function(setup){if(XORIGN)return ajax(setup);var script=create('script'),unique='x'+now(),waitlimit=100,timeout=setTimeout(function(){done('timeout')},setup.timeout||30000),url=setup.url,data=setup.data||{},fail=setup.fail||function(){},success=setup.success||function(){},append=function(){setTimeout(function(){waitlimit*=2;try{var myhead=head(),myfirst=myhead.firstChild;if(myfirst)myhead.insertBefore(script,myfirst);else myhead.appendChild(script)}catch(err){append()}},waitlimit)},done=function(failed){clearTimeout(timeout);if(!script)return;failed&&fail.call(failed,script,unescape(script.src));script.onerror=null;try{head().removeChild(script)}catch(error){}};script[ASYNC]=ASYNC;window[unique]=function(response){if(!response)return done('no data');success.call(script,response);window[unique]=null;done(0)};bind('error',script,function(){done('error')});data['unique']=unique;script.src=url+urlize(data,url);append();return done},jsonp_rx=/^window\[[^\]]+\]\((.+?)\)$/,ajax=function(setup){var xhr=window['ActiveXObject']?new window['ActiveXObject']("Microsoft.XMLHTTP"):new XMLHttpRequest(),rsc=function(){if(xhr&&xhr.readyState==4&&!done){var status=xhr.status;done=1;if(ival){clearInterval(ival);ival=null}if((status>=200&&status<300)||status==304||status==1223){success(JSON.parse(xhr.responseText.replace(jsonp_rx,'$1')))}else fail(xhr);xhr=null}},fail=setup.fail||function(){},success=setup.success||function(){},done=0,data=setup.data||{},url=setup.url,ival=setInterval(rsc,14);data['unique']='x'+now();try{xhr.open('GET',url+urlize(data,url),true);xhr.send()}catch(eee){XORIGN=0;return xdr(setup)}return function(){done=1;if(xhr){xhr.abort&&xhr.abort()}}};var ORIGIN='http://x.chatforyoursite.com/',LIMIT=1700,COMET={'history':function(args,callback){callback=callback||function(){};args['limit']=args['limit']||100;if(!args['channel'])return log('Must Specify a Channel');args['channel']=COMET.subscribe_key+'/'+args['channel'];xdr({url:ORIGIN+'comet-history',data:args,success:function(response){callback(response['messages'])},fail:function(response){log(response)}})},'time':function(callback){xdr({url:ORIGIN+'comet-time',success:function(response){callback(response['time'])},fail:function(){callback(0)}})},'uuid':function(callback){xdr({url:ORIGIN+'comet-uuid',success:function(response){callback(response['uuid'])},fail:function(){callback(0)}})},'publish':function(args,callback){callback=callback||function(){}||args['callback'];var message=args['message'];if(!message)return log('Must Specify a Message');if(!args['channel'])return log('Must Specify a Channel');message=stringify(message);if(message.length>LIMIT)return log('Message exceeded limit '+LIMIT);if(!COMET.publish_key)return log('Missing Publish Key');args['publish_key']=COMET.publish_key;args['channel']=COMET.subscribe_key+'/'+args['channel'];args['message']=message;xdr({url:ORIGIN+'comet-publish',data:args,success:function(response){callback(response)},fail:function(response){callback(response)}})},'unsubscribe':function(args){var channel=COMET.subscribe_key+'/'+args['channel'];if(!(channel in COMET.channels))return;COMET.channels[channel].disabled=1;COMET.channels[channel].connected=0;COMET.channels[channel].done&&COMET.channels[channel].done(0)},ready:0,ready_buffer:[],'subscribe':function(args,callback){if(!COMET.ready){return COMET.ready_buffer.push([args,callback])}if(!args['channel'])return log('Must Specify a Channel');callback=callback||args['callback'];if(!callback)return log('Must Specify a Callback');if(!COMET.subscribe_key)return log('Missing Subscribe Key');var timetoken=0,waitlimit=100,channel=args['channel']=COMET.subscribe_key+'/'+args['channel'];if(!(channel in COMET.channels))COMET.channels[channel]={};if(COMET.channels[channel].connected)return log('Already Connected to this Channel: '+channel);COMET.channels[channel].disabled=0;COMET.channels[channel].connected=1;function find_COMET_server(){setTimeout(function(){waitlimit*=2;xdr({url:ORIGIN+'comet-subscribe',data:args,success:function(response){if(response&&response['server']){comet(response['server'])}else find_COMET_server()},fail:function(response){find_COMET_server()}})},waitlimit)}find_COMET_server();function comet(server){if(channel in COMET.channels&&COMET.channels[channel].disabled)return;COMET.channels[channel].done=xdr({url:'http://'+server+'/',data:{'channel':channel,'timetoken':timetoken},success:function(response){timetoken=response['timetoken'];comet(server);if(response['messages'][0]!='xdr.timeout')each(response['messages'],function(msg){callback(msg)})},fail:function(response){if(response=='timeout')comet(server);else find_COMET_server()}})}},publish_key:'',subscribe_key:'<?php echo KEY_B;?>',application_key:'',channels:{},'xdr':xdr,'each':each,'map':map,'css':css,'$':$,'create':create,'bind':bind,'supplant':supplant,'head':head,'search':search,'attr':attr,'now':now};ajax({url:ORIGIN+'comet-x-origin',success:function(message){if(message['x-origin'])XORIGN=1}});bind('load',window,function(){setTimeout(function(){COMET.ready=1;each(COMET.ready_buffer,function(sub){COMET['subscribe'](sub[0],sub[1])})},100)});window['COMET']=COMET})();
<?php } ?>